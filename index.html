<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>task.js by manjeshbhargav</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">task.js</h1>
      <h2 class="project-tagline">JavaScript library for building and running tasks.</h2>
      <a href="https://github.com/manjeshbhargav/task.js" class="btn">View on GitHub</a>
      <a href="https://github.com/manjeshbhargav/task.js/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/manjeshbhargav/task.js/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="taskjs" class="anchor" href="#taskjs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a href="https://github.com/manjeshbhargav/task.js.git">task.js</a>
</h1>

<p><a href="https://badge.fury.io/js/lib-task"><img src="https://badge.fury.io/js/lib-task.svg" alt="npm version"></a>
<a href="https://travis-ci.org/manjeshbhargav/task.js.svg"><img src="https://travis-ci.org/manjeshbhargav/task.js.svg" alt="Travis CI"></a>
<a href="https://img.shields.io/badge/License-MIT-blue.svg"><img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="Lincense MIT"></a></p>

<p><code>task.js</code> is a JavaScript library for creating logical groups of instructions called <code>tasks</code>. These tasks leverage the <code>Promise</code>
pattern to allow application logic to specify when a task is <code>done(result)</code> or <code>failed(reason)</code>.</p>

<h2>
<a id="advantages-over-direct-promises" class="anchor" href="#advantages-over-direct-promises" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Advantages over direct <code>Promise</code>s</h2>

<ul>
<li>You don't have to promisify your async functions that use callbacks.</li>
<li>However, you can safely use <code>Promise</code>s within tasks.</li>
<li>Powerful APIs to execute a group of tasks, or the same task a number of times.</li>
<li>You can give a human readable name to your tasks thereby improving code readability.</li>
<li>These tasks can be easily testable with <code>Promise</code> based frameworks like <code>mocha.js</code>.</li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<ul>
<li>
<p>For <code>Node.js</code> or <code>browserify/webpack</code> projects</p>

<pre><code>npm install lib-task
</code></pre>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> Task <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>lib-task<span class="pl-pds">'</span></span>);</pre></div>
</li>
<li>
<p>For standard web projects</p>

<pre><code>git clone https://github.com/manjeshbhargav/task.js.git
</code></pre>

<pre><code>cd task.js &amp;&amp; npm run build
</code></pre>

<p>Then, you can use <code>./dist/task.js</code> or <code>./dist/task.min.js</code> in your web project using <code>&lt;script&gt;</code>.</p>
</li>
</ul>

<h2>
<a id="task-template" class="anchor" href="#task-template" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Task <code>template</code>
</h2>

<p>A <code>template</code> is basically a <code>function</code> that defines the set of instructions that the task will be performing. It follows this format:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c">/**</span>
<span class="pl-c"> * A task template.</span>
<span class="pl-c"> * <span class="pl-k">@param</span> {...*} taskArguments - Arguments for executing the task.</span>
<span class="pl-c"> * <span class="pl-k">@param</span> <span class="pl-en">{function}</span> <span class="pl-smi">done</span> - Called (with results, if any) by the task when it's done.</span>
<span class="pl-c"> * <span class="pl-k">@param</span> <span class="pl-en">{function}</span> <span class="pl-smi">failed</span> - Called (with errors, if any) by the task when it fails.</span>
<span class="pl-c"> * <span class="pl-k">@returns</span> <span class="pl-en">{*}</span></span>
<span class="pl-c"> */</span>
<span class="pl-k">function</span> <span class="pl-en">template</span>(<span class="pl-k">...</span><span class="pl-v">taskArguments</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {
  <span class="pl-k">...</span>
  <span class="pl-k">...</span>
  <span class="pl-en">doSomeAsyncTask</span>(args, done, failed);
}</pre></div>

<h2>
<a id="creating-a-task" class="anchor" href="#creating-a-task" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating a task</h2>

<p>You can create a task like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> loginAttempt <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">create</span>(<span class="pl-s"><span class="pl-pds">'</span>attempting to log in<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">endpoint</span>, <span class="pl-smi">credentials</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {
  <span class="pl-k">var</span> username <span class="pl-k">=</span> <span class="pl-smi">credentials</span>.<span class="pl-smi">username</span>;
  <span class="pl-k">var</span> password <span class="pl-k">=</span> <span class="pl-smi">credentials</span>.<span class="pl-smi">password</span>;
  <span class="pl-c">// Using JQuery AJAX to contact the login endpoint</span>
  <span class="pl-smi">$</span>.<span class="pl-en">post</span>({
    url<span class="pl-k">:</span> endpoint,
    data<span class="pl-k">:</span> { u<span class="pl-k">:</span> username, p<span class="pl-k">:</span> password },
    <span class="pl-en">success</span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">response</span>) { <span class="pl-en">done</span>(<span class="pl-c1">JSON</span>.<span class="pl-c1">parse</span>(response)); },
    failure<span class="pl-k">:</span> failed
  });
});</pre></div>

<p>Here, <code>endpoint</code> and <code>credentials</code> are the arguments required for doing the task. In this example, <code>done()</code> is called when the login
<code>endpoint</code> responds with a success <code>JSON</code> message, and <code>failed()</code> is called when it responds with the reason for the failure.</p>

<p>There are other ways to specify when the task is <code>done/failed</code>:</p>

<ul>
<li>
<p><code>return</code>ing a value: A task is considered <code>done</code> if the <code>template</code>
<code>return</code>s any non-<code>Promise</code> value, and <code>failed</code> if it throws an exception.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> addTask <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">create</span>(<span class="pl-s"><span class="pl-pds">'</span>add two numbers<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>) {
  <span class="pl-k">return</span> (a <span class="pl-k">+</span> b);
});</pre></div>
</li>
<li>
<p><code>return</code>ing a <code>Promise</code>: A task is considered <code>done/failed</code> if the
<code>Promise</code> returned by the <code>template</code> is <code>resolved/rejected</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> promiseTask <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">create</span>(<span class="pl-s"><span class="pl-pds">'</span>track a promise<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>) {
  <span class="pl-k">...</span>
  <span class="pl-k">...</span>
  <span class="pl-k">return</span> <span class="pl-en">someAsyncFunctionThatReturnsAPromise</span>(a, b);
});</pre></div>
</li>
</ul>

<h2>
<a id="executing-a-task" class="anchor" href="#executing-a-task" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Executing a task</h2>

<p>The <code>loginAttempt</code> task that was created in the previous section
can be executed like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">loginAttempt</span>.<span class="pl-en">do</span>(<span class="pl-s"><span class="pl-pds">'</span>/services/login<span class="pl-pds">'</span></span>, {
  usename<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>johndoe<span class="pl-pds">'</span></span>,
  password<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>xyz123<span class="pl-pds">'</span></span>
}).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">success</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Login successful! - <span class="pl-pds">'</span></span>, success);
}).<span class="pl-en">catch</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">error</span>(<span class="pl-s"><span class="pl-pds">'</span>Login failed! - <span class="pl-pds">'</span></span>, error);
});</pre></div>

<p>Here, the argument passed to <code>done()</code> is passed on to the <code>Promise</code>'s
<code>then()</code> callback, while the argument passed to <code>failed()</code> is passed
on to the <code>catch()</code> callback.</p>

<ul>
<li>
<p><code>addTask</code> from the previous section can be executed like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">addTask</span>.<span class="pl-en">do</span>(<span class="pl-c1">2</span>, <span class="pl-c1">3</span>).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">sum</span>) {
  <span class="pl-c">// sum is the return value of addTask's template.</span>
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Sum is - <span class="pl-pds">'</span></span>, sum);
}).<span class="pl-en">catch</span>(<span class="pl-k">function</span>(<span class="pl-smi">e</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">error</span>(<span class="pl-s"><span class="pl-pds">'</span>Exception thrown while executing template - <span class="pl-pds">'</span></span>, e); 
});</pre></div>
</li>
<li>
<p><code>promiseTask</code> from the previous section can be executed like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">promiseTask</span>.<span class="pl-en">do</span>(<span class="pl-s"><span class="pl-pds">'</span>a<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>b<span class="pl-pds">'</span></span>).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">result</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Promise returned by the template was resolved with - <span class="pl-pds">'</span></span>, result);
}).<span class="pl-en">catch</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">error</span>(<span class="pl-s"><span class="pl-pds">'</span>Promise returned by the template was rejected with - <span class="pl-pds">'</span></span>, error);
});</pre></div>
</li>
</ul>

<h2>
<a id="canceling-a-task" class="anchor" href="#canceling-a-task" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Canceling a task</h2>

<p>Sometimes we need to cancel a task after starting it. We can do it like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> timeout <span class="pl-k">=</span> <span class="pl-c1">null</span>;
<span class="pl-k">var</span> task <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">create</span>(<span class="pl-s"><span class="pl-pds">'</span>cancelable task<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">ms</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {
  timeout <span class="pl-k">=</span> <span class="pl-c1">setTimeout</span>(<span class="pl-k">function</span>() { <span class="pl-en">failed</span>(<span class="pl-s"><span class="pl-pds">'</span>Timeout over!<span class="pl-pds">'</span></span>); }, ms);
});

<span class="pl-smi">task</span>.<span class="pl-en">do</span>(<span class="pl-c1">5000</span>).<span class="pl-en">then</span>(<span class="pl-k">function</span>() {<span class="pl-k">...</span>}).<span class="pl-en">catch</span>(<span class="pl-k">function</span>(<span class="pl-smi">reason</span>) {
  <span class="pl-k">if</span> (reason <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>canceled<span class="pl-pds">'</span></span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>We are here because the task was actively canceled.<span class="pl-pds">'</span></span>);
  }
  <span class="pl-k">else</span> {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>We are here because the task failed().<span class="pl-pds">'</span></span>);
  }
  <span class="pl-c1">clearTimeout</span>(timeout);
  timeout <span class="pl-k">=</span> <span class="pl-c1">null</span>;
});

<span class="pl-c">// The argument to cancel() is anything that we want to</span>
<span class="pl-c">// pass to the Promise's catch() that helps us determine why it</span>
<span class="pl-c">// was rejected.</span>
<span class="pl-smi">task</span>.<span class="pl-en">cancel</span>(<span class="pl-s"><span class="pl-pds">'</span>canceled<span class="pl-pds">'</span></span>);</pre></div>

<h2>
<a id="timing-out-a-task" class="anchor" href="#timing-out-a-task" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Timing out a task</h2>

<p>Sometimes we want to set a time limit for a task to complete (<code>done()</code> or <code>failed()</code>). We can do it like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> xhr <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">XMLHttpRequest</span>();
<span class="pl-k">var</span> getUrl <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">create</span>(<span class="pl-s"><span class="pl-pds">'</span>get content of url<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">url</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {
  <span class="pl-smi">xhr</span>.<span class="pl-c1">open</span>(<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>, url, <span class="pl-c1">true</span>);
  <span class="pl-smi">xhr</span>.<span class="pl-en">onreadystatechange</span> <span class="pl-k">=</span> <span class="pl-k">function</span>() {
    <span class="pl-k">if</span> (<span class="pl-smi">xhr</span>.<span class="pl-c1">status</span> <span class="pl-k">===</span> <span class="pl-c1">200</span> <span class="pl-k">&amp;&amp;</span> <span class="pl-smi">xhr</span>.<span class="pl-c1">readyState</span> <span class="pl-k">===</span> <span class="pl-c1">4</span>) {
      <span class="pl-en">done</span>(<span class="pl-smi">xhr</span>.<span class="pl-c1">responseText</span>);
    }
  };
  <span class="pl-smi">xhr</span>.<span class="pl-c1">send</span>();
});

<span class="pl-c">// The second argument to timeout() is anything that we want to</span>
<span class="pl-c">// pass to the Promise's catch() that helps us determine why it</span>
<span class="pl-c">// was rejected.</span>
<span class="pl-smi">getUrl</span>.<span class="pl-en">timeout</span>(<span class="pl-c1">5000</span>, { reason<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>timeout<span class="pl-pds">'</span></span> });

<span class="pl-smi">getUrl</span>.<span class="pl-en">do</span>(<span class="pl-s"><span class="pl-pds">'</span>http://www.x.y.com/?a=b<span class="pl-pds">'</span></span>).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">response</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Response: <span class="pl-pds">'</span></span>, response);
}).<span class="pl-en">catch</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
  <span class="pl-k">if</span> (<span class="pl-smi">error</span>.<span class="pl-smi">reason</span> <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>timeout<span class="pl-pds">'</span></span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Task timed out.<span class="pl-pds">'</span></span>);
  }
  <span class="pl-smi">xhr</span>.<span class="pl-c1">abort</span>();
});</pre></div>

<h2>
<a id="executing-tasks-serially" class="anchor" href="#executing-tasks-serially" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Executing tasks serially</h2>

<p>Sometimes we need to perform a set of tasks serially, where the next task depends on the result from the previous task.
We can do it like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> task1 <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">create</span>(<span class="pl-s"><span class="pl-pds">'</span>task 1<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">task1Arg</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {<span class="pl-k">...</span>});
<span class="pl-k">var</span> task2 <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">create</span>(<span class="pl-s"><span class="pl-pds">'</span>task 2<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">task1Result</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {<span class="pl-k">...</span>});
<span class="pl-k">var</span> task3 <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">create</span>(<span class="pl-s"><span class="pl-pds">'</span>task 3<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">task2Result</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {<span class="pl-k">...</span>});
<span class="pl-k">var</span> taskSequence <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">sequence</span>(<span class="pl-s"><span class="pl-pds">'</span>sequence<span class="pl-pds">'</span></span>, [task1, task2, task3]);

<span class="pl-c">// The arguments of Task#do() are arguments for the first task in the sequence.</span>
<span class="pl-smi">taskSequence</span>.<span class="pl-en">do</span>(<span class="pl-c1">10</span>).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">task3Result</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>All done one after the other!<span class="pl-pds">'</span></span>);
}).<span class="pl-en">catch</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">error</span>(<span class="pl-s"><span class="pl-pds">'</span>One of the tasks failed - <span class="pl-pds">'</span></span>, error);
});</pre></div>

<h2>
<a id="executing-tasks-in-parallel" class="anchor" href="#executing-tasks-in-parallel" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Executing tasks in parallel</h2>

<p>Sometimes we need to wait for a set of independent tasks to be executed before we can proceed. We can do it like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> task1 <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">create</span>(<span class="pl-s"><span class="pl-pds">'</span>task1<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">arg1</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {<span class="pl-k">...</span>});
<span class="pl-k">var</span> task2 <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">create</span>(<span class="pl-s"><span class="pl-pds">'</span>task2<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">arg21</span>, <span class="pl-smi">arg22</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {<span class="pl-k">...</span>});
<span class="pl-k">var</span> task3 <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">create</span>(<span class="pl-s"><span class="pl-pds">'</span>task3<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">arg31</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {<span class="pl-k">...</span>});
<span class="pl-k">var</span> taskParallel <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">parallel</span>(<span class="pl-s"><span class="pl-pds">'</span>parallel<span class="pl-pds">'</span></span>, [task1, task2, task3]);

<span class="pl-c">// The arguments for Task#do() is (args1, args2, args3), where:</span>
<span class="pl-c">// * args1 =&gt; Array of arguments for task1's template</span>
<span class="pl-c">// * args2 =&gt; Array of arguments for task2's template</span>
<span class="pl-c">// * args3 =&gt; Array of arguments for task3's template</span>
<span class="pl-c">// NOTE: If there is only one argument for a task, then there is no</span>
<span class="pl-c">//       need to enclose it in an array.</span>
<span class="pl-smi">taskParallel</span>.<span class="pl-en">do</span>(<span class="pl-c1">1</span>, [<span class="pl-s"><span class="pl-pds">'</span>2<span class="pl-pds">'</span></span>, <span class="pl-c1">true</span>], {}).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">results</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Results of all completed tasks - <span class="pl-pds">'</span></span>, results);
}).<span class="pl-en">catch</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">error</span>(<span class="pl-s"><span class="pl-pds">'</span>One of the tasks failed - <span class="pl-pds">'</span></span>, error);
});</pre></div>

<h2>
<a id="executing-an-anonymous-task" class="anchor" href="#executing-an-anonymous-task" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Executing an anonymous task</h2>

<p>Sometimes we don't want to create and then do a task because it is one-off and we don't intend to re-do it at any point in the
future. We can do it like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Task</span>.<span class="pl-en">do</span>(<span class="pl-k">function</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {
  <span class="pl-en">startMyApplication</span>(a, b, <span class="pl-k">function</span>(<span class="pl-smi">started</span>, <span class="pl-smi">result</span>) {
    <span class="pl-k">var</span> status <span class="pl-k">=</span> started <span class="pl-k">?</span> done <span class="pl-k">:</span> failed;
    <span class="pl-en">status</span>(result);
  });
}, <span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">'</span>2<span class="pl-pds">'</span></span>).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">outcome</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Application successfully started! - <span class="pl-pds">'</span></span>, outcome);
}).<span class="pl-en">catch</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">error</span>(<span class="pl-s"><span class="pl-pds">'</span>Problem starting application! - <span class="pl-pds">'</span></span>, error);
});</pre></div>

<h2>
<a id="re-trying-a-task" class="anchor" href="#re-trying-a-task" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Re-trying a task</h2>

<p>Sometimes we want to try a task a number of times until it succeeds, or we've tried a certain number of times.
Ex: If we lose our connection with the server, we would want to re-try connecting for a certain number of times.
We can do it like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> numRetries <span class="pl-k">=</span> <span class="pl-c1">10</span>;
<span class="pl-k">var</span> retryConnection <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">try</span>(<span class="pl-s"><span class="pl-pds">'</span>retry connecting to server<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">request</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {
  <span class="pl-smi">request</span>.<span class="pl-en">connect</span>(<span class="pl-s"><span class="pl-pds">'</span>/server/connect<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">response</span>) {
    <span class="pl-k">if</span> (<span class="pl-smi">response</span>.<span class="pl-smi">connection</span>) { <span class="pl-en">done</span>(<span class="pl-smi">response</span>.<span class="pl-smi">connection</span>); }
    <span class="pl-k">else</span> { <span class="pl-en">failed</span>(<span class="pl-smi">response</span>.<span class="pl-smi">error</span>); }
  });
});

<span class="pl-k">function</span> <span class="pl-en">retryConnect</span>() {
  <span class="pl-smi">retryConnection</span>.<span class="pl-en">do</span>(<span class="pl-k">new</span> <span class="pl-en">Request</span>(), numRetries).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">connection</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Connected! - <span class="pl-pds">'</span></span>, connection);
    <span class="pl-smi">connection</span>.<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>lost<span class="pl-pds">'</span></span>, retryConnect);
  }).<span class="pl-en">catch</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">error</span>(<span class="pl-s"><span class="pl-pds">'</span>Failed to connect after <span class="pl-pds">'</span></span> <span class="pl-k">+</span> numRetries <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span> tries! - <span class="pl-pds">'</span></span>, error);
  });
}</pre></div>

<h1>
<a id="running-a-task-for-each-item-in-an-array" class="anchor" href="#running-a-task-for-each-item-in-an-array" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running a task for each item in an array</h1>

<p>Sometimes we want to run a task on each item of an array, and once we have gotten all the results,
act on them (like <code>Array.prototype.map()</code>, only async). We can do it like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> getHtmlMap <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">map</span>(<span class="pl-s"><span class="pl-pds">'</span>get html of a given url<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">url</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {
  <span class="pl-smi">http</span>.<span class="pl-c1">get</span>(url, <span class="pl-k">function</span>(<span class="pl-smi">response</span>) {
    <span class="pl-k">var</span> html <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>;
    <span class="pl-smi">response</span>.<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>data<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
      html <span class="pl-k">+=</span> data;
    });
    <span class="pl-smi">response</span>.<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>end<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
      <span class="pl-en">done</span>(html);
    });
  }).<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">'</span>error<span class="pl-pds">'</span></span>, failed);
});

<span class="pl-c">// The argument for Task#do() is an array where the task has to be</span>
<span class="pl-c">// performed once for each item in parallel.</span>
<span class="pl-smi">getHtmlMap</span>.<span class="pl-en">do</span>([<span class="pl-s"><span class="pl-pds">'</span>http://www.ex1.com<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>http://www.ex2.com<span class="pl-pds">'</span></span>]).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">htmls</span>) {
  <span class="pl-smi">htmls</span>.<span class="pl-c1">forEach</span>(<span class="pl-k">function</span>(<span class="pl-smi">html</span>, <span class="pl-smi">i</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>HTML["<span class="pl-pds">'</span></span> <span class="pl-k">+</span> domains[i] <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>"]: <span class="pl-pds">'</span></span>, html);
  });
}).<span class="pl-en">catch</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Failed to get htmls - <span class="pl-pds">'</span></span>, error);
});</pre></div>

<h1>
<a id="delayed-execution-of-a-task" class="anchor" href="#delayed-execution-of-a-task" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Delayed execution of a task</h1>

<p>Sometimes we want to execute a task after a certain period of time. We can do it like this:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> delayedTask <span class="pl-k">=</span> <span class="pl-smi">Task</span>.<span class="pl-en">delay</span>(<span class="pl-s"><span class="pl-pds">'</span>check status after 5 seconds<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(<span class="pl-smi">url</span>, <span class="pl-smi">done</span>, <span class="pl-smi">failed</span>) {
  <span class="pl-smi">$</span>.<span class="pl-en">getJSON</span>(url, done, failed);
});

<span class="pl-c">// The last argument to Task#do() is the wait time in milliseconds.</span>
<span class="pl-smi">delayedTask</span>.<span class="pl-en">do</span>(<span class="pl-s"><span class="pl-pds">'</span>http://www.x.y.com/status/me<span class="pl-pds">'</span></span>, <span class="pl-c1">5000</span>).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">status</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Status: <span class="pl-pds">'</span></span>, status);
}).<span class="pl-en">catch</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
  <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>Failed to get status: <span class="pl-pds">'</span></span>, error);
});</pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/manjeshbhargav/task.js">task.js</a> is maintained by <a href="https://github.com/manjeshbhargav">manjeshbhargav</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
